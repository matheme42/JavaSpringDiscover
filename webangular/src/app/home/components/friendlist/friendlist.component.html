<div class="mx-2 border-2 p-4">
  <div class="mb-2 flex flex-row justify-start items-start">
    <h2 class="underline">AMIS</h2>
    <div>
      <div class="">
        <div class="rounded-md shadow-sm ml-2">
          <form [formGroup]="usernameForm">
            <div class="form-group">
              <input type="text" (focus)="onFocus($event)" (blur)="onFocus($event)" name="name" id="name"
                formControlName="name"
                class="block w-full rounded-md border-0 py-1.8 pl-2 pr-20 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-1 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                placeholder="bob">
            </div>
          </form>
        </div>
        <ul role="list" [ngStyle]="{ display: inputFocus ? 'block' : 'none' }"
          class="divide-y divide-gray-100 absolute border-2 rounded-md mt-1 ml-2">
          @for (ami of searchedUser ; track $index) {
          <li class="flex justify-between gap-x-6 py-2 bg-slate-50 rounded-sm px-4 my-2 items-center">
            <div class="flex min-w-0 gap-x-4">
              <img class="h-12 w-12 flex-none rounded-full bg-gray-50"
                src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                alt="">
              <div class="min-w-0 flex-auto">
                <p class="text-sm font-semibold leading-6 text-gray-900">{{ami.username}}</p>
                <p class="text-sm leading-6 text-gray-900">{{ami.role}}</p>
              </div>
            </div>
            <div class="shrink-0 flex flex-raw items-center min-w-64 justify-end">
              <button type="submit" (mousedown)="sendFriendShipInvitation(ami.username)"
                class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Ajouter</button>
            </div>
          </li>
          }
        </ul>
      </div>
    </div>
  </div>
  <ul role="list" class="divide-y divide-gray-100">
    @for (ami of pendingAmis ; track $index) {
    <li class="flex justify-between gap-x-6 py-2 bg-slate-50 rounded-sm px-4 my-2">
      <div class="flex min-w-0 gap-x-4">
        <img class="h-12 w-12 flex-none rounded-full bg-gray-50"
          src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
          alt="">
        <div class="min-w-0 flex-auto">
          <p class="text-sm font-semibold leading-6 text-gray-900">{{ami.username}}</p>
          <p class="text-sm leading-6 text-gray-900">{{ami.role}}</p>
        </div>
      </div>
      <p class="hidden sm:flex font-light italic">Demande Envoyés</p>
      <div class="shrink-0 flex flex-raw items-center min-w-64 justify-end">
        <button type="button" (click)="removeFriendShip(ami.username)"
          class="text-sm font-semibold leading-6 mr-1 text-red-500 hover:bg-red-500 hover:text-white rounded-md py-1 px-3">Annuler</button>
      </div>
    </li>
    }
  </ul>
  <ul role="list" class="divide-y divide-gray-100">
    @for (ami of invitations ; track $index) {
    <li class="flex justify-between gap-x-6 py-2 bg-slate-50 rounded-sm px-4 my-2 items-center">
      <div class="flex min-w-0 gap-x-4">
        <img class="h-12 w-12 flex-none rounded-full bg-gray-50"
          src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
          alt="">
        <div class="min-w-0 flex-auto">
          <p class="text-sm font-semibold leading-6 text-gray-900">{{ami.username}}</p>
          <p class="text-sm leading-6 text-gray-900">{{ami.role}}</p>
        </div>
      </div>
      <p class="hidden sm:flex font-light italic">Demande Reçu</p>
      <div class="shrink-0 flex flex-raw items-center min-w-64 justify-end">
        <button type="button" (click)="replyFriendShip(ami.username, false)"
          class="text-sm font-semibold leading-6 mr-1 text-red-500 hover:bg-red-500 hover:text-white rounded-md py-1 px-3">Refuser</button>
        <button type="submit" (click)="replyFriendShip(ami.username, true)"
          class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Accepter</button>
      </div>
    </li>
    }
  </ul>
  <ul role="list" class="divide-y divide-gray-100">
    @for (ami of amis ; track $index) {
    <li class="flex justify-between gap-x-6 py-2 bg-slate-50 rounded-sm px-4 my-2">
      <div class="flex min-w-0 gap-x-4">
        <img class="h-12 w-12 flex-none rounded-full bg-gray-50"
          src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
          alt="">
        <div class="min-w-0 flex-auto">
          <p class="text-sm font-semibold leading-6 text-gray-900">{{ami.username}}</p>
          <p class="text-sm leading-6 text-gray-900">{{ami.role}}</p>
        </div>
      </div>
      <div class="shrink-0 flex flex-row items-center  min-w-64 justify-end">
        <div>
        <div class="flex flex-row items-center justify-end mr-10">
          <div class="w-4 h-4 mr-2 mb-3 rounded-full" [ngClass]="ami.logged ? 'bg-green-500' : 'bg-red-500' "></div>
          <p class="text-sm font-semibold leading-6 text-gray-900"> {{ami.logged ? 'En ligne' : 'Hors Ligne'}}</p>
        </div>
        @if (ami.logged == false) {
        <p class="leading-6 text-gray-900 font-bold italic text-xs">Vu: {{ami.last_connection | date: 'dd/MM/yy, à
          HH:mm'}}</p>
        }
        </div>
        <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)=removeFriendShip(ami.username)>
            <mat-icon>delete</mat-icon>
            <span>Delete</span>
          </button>
          <button mat-menu-item (click)=openChatFromUser(ami)>
            <mat-icon>chat</mat-icon>
            <span>Chat</span>
          </button>
        </mat-menu>
      </div>
    </li>
    }
  </ul>
</div>